<div class="table-container">
  <div class="header-actions">
    <div class="search-bar">
      <input
        type="text"
        placeholder="Rechercher par nom ou catégorie"
        [(ngModel)]="searchTerm"
        (input)="applyFilters()"
      />
    </div>

    <div class="rightMenu">
      <select [(ngModel)]="filterStatut" (change)="applyFilters()">
        <option value="Tous">Tous</option>
        <option value="Actif">Actif</option>
        <option value="En_attente">En attente</option>
        <option value="Rejete">Rejeté</option>
      </select>
      <button class="btn-primary" routerLink="/associations/create">+ Nouvelle Association</button>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Nom</th>
        <th>Catégorie</th>
        <th>Contact</th>
        <th>Statut</th>
        <th>Date de création</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let asso of paginatedAssociations">
        <td class="tdTitre">{{ asso.name }}</td>
        <td>{{ asso.categorie}}</td>
        <td>{{ asso.email }}<br />{{ asso.phone }}</td>
        <td>
          <span class="status" [ngClass]="asso.statut">
            @if(asso.statut === 'Actif'){
            <img src="edite/actif.svg" alt="" srcset="" />
            } @else if(asso.statut === 'Rejete'){
            <img src="edite/rejete.svg" alt="" srcset="" />
            }
            {{ asso.statut }}
          </span>
        </td>
        <td>{{ asso.dateCreation |date:"dd-MM-yyyy"}}</td>
        <td>
          <button (click)="openViewModal(asso)">
            <img src="edite/voir.svg" alt="" srcset="" />
          </button>
          <button (click)="detail(asso)">
            <img src="edite/editer.svg" alt="" srcset="" />
          </button>
          <button (click)="openDeleteModal(asso)">
            <img src="edite/supprimer.svg" alt="" srcset="" />
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="pagination">
    <div class="left">
      <p>Affichage de {{ itemsPerPage }} elements sur {{ filteredAssociations.length }}</p>
    </div>
    <div>
      <button (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">
        Précédent
      </button>
      <span>{{ currentPage }}</span>
      <button
        (click)="changePage(currentPage + 1)"
        [disabled]="currentPage >= filteredAssociations.length / itemsPerPage"
      >
        Suivant
      </button>
    </div>
  </div>
</div>
<!-- ========== MODALE APERCU ASSOCIATION ========== -->
@if (showViewModal) {
<div class="modal">
  <div class="modal-content vue">

    <!-- Header fixe -->
    <!-- Bannière couverture -->
    <div class="modal-banner" *ngIf="covertUrl">
      <img [src]="covertUrl || 'assets/images/default-banner.png'" alt="Couverture de {{ selectedAssociation?.name }}" />
    </div>
    <div class="modal-header">
      <div class="icon">
        <img [src]="imageUrl || 'assets/images/default-logo.png'" alt="Logo de {{ selectedAssociation?.name }}" />
      </div>
      <div class="header-info">
        <h3>{{ selectedAssociation?.name }}</h3>
        <span class="status" [ngClass]="selectedAssociation?.statut">
          {{ selectedAssociation?.statut }}
        </span>
      </div>
      <button class="close-btn" (click)="closeModals()">&times;</button>
    </div>

    <!-- Body scrollable -->
    <div class="modal-body">
      <p>{{ selectedAssociation?.description || 'Aucune description fournie.' }}</p>
      <div class="info">
        <p><strong>Catégorie :</strong> {{ selectedAssociation?.categorie || 'N/A' }}</p>
        <p><strong>Email :</strong> {{ selectedAssociation?.email }}</p>
        <p><strong>Téléphone :</strong> {{ selectedAssociation?.phone }}</p>
        <p><strong>Adresse :</strong> {{ selectedAssociation?.address || 'N/A' }}</p>
        <p><strong>Date de création :</strong> {{ selectedAssociation?.dateCreation | date:'dd/MM/yyyy' }}</p>
        <p><strong>Type :</strong> {{ selectedAssociation?.typeAssociation || 'N/A' }}</p>
        <p><strong>Pays :</strong> {{ selectedAssociation?.pays || 'N/A' }}</p>
        <p><strong>Ville :</strong> {{ selectedAssociation?.ville || 'N/A' }}</p>
        <p><strong>Site Web :</strong>
          <a *ngIf="selectedAssociation?.siteWeb" [href]="selectedAssociation?.siteWeb" target="_blank">{{ selectedAssociation?.siteWeb }}</a>
          <span *ngIf="!selectedAssociation?.siteWeb">N/A</span>
        </p>
        <p><strong>Numéro d’enregistrement :</strong> {{ selectedAssociation?.numeroEnregistrement || 'N/A' }}</p>
        <p><strong>Représentant :</strong> {{ selectedAssociation?.nomComplet || 'N/A' }}</p>
        <p><strong>Fonction :</strong> {{ selectedAssociation?.fonction || 'N/A' }}</p>
        <p><strong>Confirmation officielle :</strong>
          <span [style.color]="selectedAssociation?.confirmationOfficielle ? 'green' : 'red'">
            {{ selectedAssociation?.confirmationOfficielle ? 'Oui' : 'Non' }}
          </span>
        </p>
      </div>
    </div>

    <!-- Footer fixe avec boutons -->
    <div class="modal-footer">
      @if (selectedAssociation?.statut == 'En_attente') {
        <button (click)="validerAssociation(selectedAssociation!)" class="btn-primary">Valider</button>
        <button (click)="refuserAssociation(selectedAssociation!)">Refuser</button>
      } @else {
        @if (selectedAssociation?.active) {
          <button (click)="desactiveAssociation(selectedAssociation!)" class="btn-warning">Désactiver</button>
        } @else if (!selectedAssociation?.active && selectedAssociation?.statut !== 'Rejete') {
          <button (click)="validerAssociation(selectedAssociation!)" class="btn-primary">Réactiver</button>
        } @else {
          <button (click)="desactiveAssociation(selectedAssociation!)" class="btn-warning">Supprimer</button>
        }
      }
    </div>

  </div>
</div>
}


<!-- ========== MODALE SUPPRESSION ========== -->
@if (showDeleteModal) {
<div class="modal">
  <div class="modal-content delete">
    <h3>Confirmer la suppression</h3>
    <p>
      Voulez-vous vraiment supprimer <strong>{{ selectedAssociation?.name }}</strong> ?
    </p>
    <div class="modal-actions">
      <button (click)="confirmDelete(selectedAssociation!.id!)" [disabled]="!selectedAssociation?.id">Oui, supprimer</button>
      <button (click)="closeModals()">Annuler</button>
    </div>
  </div>
</div>
}
